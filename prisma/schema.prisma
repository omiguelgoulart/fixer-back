// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Planta {
  id_planta   Int     @id @default(autoincrement())
  nome        String
  localizacao String
  area        Area[]

  @@map("plantas")
}

model Area {
  id_area   Int     @id @default(autoincrement())
  nome      String
  id_planta Int
  planta    Planta  @relation(fields: [id_planta], references: [id_planta])
  sistema   Sistema[]

  @@map("areas")
}

model Sistema {
  id_sistema Int     @id @default(autoincrement())
  nome       String
  id_area    Int
  area       Area    @relation(fields: [id_area], references: [id_area])
  ativo      Ativo[]

  @@map("sistemas")
}

model Ativo {
  id_ativo            Int              @id @default(autoincrement())
  nome                String
  codigo_patrimonio   String
  fabricante          String
  modelo              String
  data_aquisicao      DateTime?
  localizacao_interna String?
  tipo_ativo          TipoAtivo
  situacao            SituacaoAtivo    @default(ATIVO)
  criticidade         Criticidade
  id_sistema          Int
  sistema             Sistema          @relation(fields: [id_sistema], references: [id_sistema])
  subativos           Subativo[]
  manutencoes         Manutencao[]
  falhas              Falha[]

  @@map("ativos")
}

enum TipoAtivo {
  MECANICO
  ELETRICO
  ELETRONICO
  HIDRAULICO
  OUTRO
}

enum SituacaoAtivo {
  ATIVO
  INATIVO
  MANUTENCAO
  DESCARTADO
}

enum Criticidade {
  ALTA
  MEDIA
  BAIXA
}

model Falha {
  id_falha        Int      @id @default(autoincrement())
  descricao       String
  data_ocorrencia DateTime
  criticidade     Criticidade
  id_ativo        Int
  ativo           Ativo    @relation(fields: [id_ativo], references: [id_ativo])

  @@map("falhas")
}

model Subativo {
  id_subativo Int    @id @default(autoincrement())
  nome        String
  tipo        String
  id_ativo    Int
  ativo       Ativo  @relation(fields: [id_ativo], references: [id_ativo])

  @@map("subativos")
}

model Manutencao {
  id_manutencao Int             @id @default(autoincrement())
  tipo          TipoManutencao
  data_inicio   DateTime
  data_fim      DateTime
  descricao     String
  id_ativo      Int
  ativo         Ativo           @relation(fields: [id_ativo], references: [id_ativo])

  @@map("manutencoes")
}

enum TipoManutencao {
  CORRETIVA
  PREVENTIVA
  PREDITIVA
}
